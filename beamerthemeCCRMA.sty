\mode<presentation>

\RequirePackage{varwidth}

\let\Tiny\tiny % hack to remove a the following warning upon compilation of the example:
               % LaTeX Font Warning: Font shape `OT1/cmss/m/n' in size <4> not available(Font)

\newif\ifdarktheme
\newif\ifcustomtitlepage
\newif\ifusegradient
\newif\ifsimpletheme

\DeclareOption{dark}{\darkthemetrue}    % use dark theme
\DeclareOption{customtitle}{\customtitlepagetrue}    % use custom title page
\DeclareOption{gradient}{\usegradienttrue}    % use custom title page
\DeclareOption{simple}{\simplethemetrue}    % use custom title page
\ProcessOptions

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Defaults using standard Beamer themes
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ifsimpletheme
    \usetheme{Pittsburgh} % Madrid, Pittsburgh, Singapore, Copenhagen, Warsaw
\else
    \usetheme{Madrid} % Madrid, Pittsburgh, Singapore, Copenhagen, Warsaw
\fi
\usefonttheme[onlymath]{serif}
\setbeamertemplate{sections/subsections in toc}[sections numbered]
\setbeamertemplate{items}[default] % ball, circle, rectangle and default
\setbeamersize{text margin left=1cm, text margin right=1cm}
% \useoutertheme[subsection = false]{miniframes}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Color stuff
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ifdarktheme
    \ifusegradient
        \usecolortheme[gradient]{CCRMAdark}
    \else
        \usecolortheme{CCRMAdark}
    \fi
\else
    \ifusegradient
        \usecolortheme[gradient]{CCRMAlight} % this is not implemented yet
    \else
        \usecolortheme{CCRMAlight}
    \fi
\fi


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Title page stuff
% (including custom layout and added author
% email field)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% add a new command (and internal variable) to hold the author's email
\def\@authoremail{ }
\newcommand{\authoremail}[1]{
  \def\@authoremail{#1}
}

\institute[CCRMA]{% Center for Computer Research in Music and Acoustics -
    CCRMA\\
    Department of Music\\
    Stanford University%\\
    %Stanford CA, 94305
}


\def\@titlepagecontent{You should place something here. To do that use the $\backslash$\texttt{titlepagecontent} command}
\newcommand{\titlepagecontent}[1]{
  \def\@titlepagecontent{#1}
}


\ifcustomtitlepage

    % \titlegraphic{
    %     \begin{flushright}
    %         \includegraphics[scale=0.09]{ccrma-logo.pdf}\\
    %         \includegraphics[scale=0.18]{stanford-logo.pdf}
    %     \end{flushright}
    % }

    \titlegraphic{
        \includegraphics[width=0.6\textwidth]{stanford-ccrma-logo.pdf}
    }

    \defbeamertemplate*{title page}{CCRMA}[1][]
    {
      \vbox{}
      \vfill
      \begin{centering}
        \begin{beamercolorbox}[sep=8pt,center,#1,rounded=true,shadow=false]{title}
          \usebeamerfont{title}\inserttitle\par%
          \ifx\insertsubtitle\@empty%
          \else%
            \vskip0.25em%
            {\usebeamerfont{subtitle}\usebeamercolor[fg]{subtitle}\insertsubtitle\par}%
          \fi%
        \end{beamercolorbox}%
        \vskip1em\par

        \begin{varwidth}[c]{0.6\textwidth}
            \@titlepagecontent
            % {\usebeamercolor[fg]{titlegraphic}\inserttitlegraphic\par}
        \end{varwidth}
        \hspace{0.3em}
        \begin{varwidth}[c]{0.4\textwidth}
            \usebeamerfont{author}\insertauthor
            \ifx\@authoremail\@empty
            \else
            \newline\scriptsize{\url{\@authoremail}}
            \fi

            \vspace{1.8ex}
            \usebeamerfont{institute}\insertinstitute
            \usebeamerfont{date}\insertdate
            \vspace{1.8ex}
            \inserttitlegraphic
        \end{varwidth}

      \end{centering}
      \vfill
    }

\else

    \titlegraphic{
        \includegraphics[width=0.4\textwidth]{stanford-ccrma-logo.pdf}
    }

\fi


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Other stuff
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% disable the navigation buttons at the bottom of the slides
\beamertemplatenavigationsymbolsempty


\mode
<all>